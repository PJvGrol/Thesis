\chapter{Mathematical Background}
This chapter provides the mathematical background to elliptic curve cryptography. If the reader is already familiar with elliptic curves and the Weil pairing, skipping to the section on elliptic curve cryptography should not hinder the understanding of that chapter. If the reader is unfamiliar, or wishes to refresh his memory, reading this chapter is advised.

A background in and understanding of fields, rings and Galois groups is assumed in this chapter.

This chapter will start with algebraic varieties and lead up to elliptic curves and the Weil pairing, finishing with an explanation of elliptic curve cryptography.

As source material in this chapter, the excellent work of Joseph H. Silverman is used \cite[Chapter 1-3]{EllipticCurvesBook}, along with some of his slides \cite{EllipticCurvesSlides}.

\section{Algebraic Varieties}
\subsection{Notation}
Before explaining algebraic varieties, the following notation is set.
\begin{itemize}
	\item $K$ is a perfect field.
	\item $\bar{K}$ is a fixed algebraic closure of $K$.
	\item $\bar{K}[X]=\bar{K}[X_1,\dots,X_n]$ is a polynomial ring in $n$ variables.
	\item $G_{\bar{K}/K}$ is the Galois group of $\bar{K}/K$.
\end{itemize}

\subsection{Affine Varieties}
The following definition defines Cartesian $n$-space and the subsets that are defined by zeros of polynomials.
\begin{defn}
	Cartesian, also known as affine, $n$-space, which is implied to be over $K$, is the set of $n$-tuples.
	\begin{equation*}
	\mathbb{A}^n=\mathbb{A}^n(\bar{K})=\{P=(x_1,\dots,x_n):x_i\in\bar{K}\}
	\end{equation*}
	This leads to the set of $K$-rational points of $\mathbb{A}^n$ as the following set.
	
	\begin{equation*}\mathbb{A}^n(K)=\{P=(x_1,\dots,x_n)\in\mathbb{A}^n:x_i\in K\}
	\end{equation*}
\end{defn}

From this point on, any space used is, indeed, an affine space. Using the Galois group $G_{\bar{K}/K}$ allows for an alternative description of $\mathbb{A}^n(K)$, because the Galois group fixes elements $P\in\mathbb{A}^n$.
\begin{rem}
	Considering the Galois group $G_{\bar{K}/K}$ leads to an action on $\mathbb{A}^n$ such that for $\sigma\in G_{\bar{K}/K}$ and $P\in\mathbb{A}^n$, it leads to
	\begin{equation*}
	P^\sigma=(x_1^\sigma,\dots,x_n^\sigma).
	\end{equation*}
	This then allows to define $\mathbb{A}^n(K)$ as
	\begin{equation*}
	\mathbb{A}^n(K)=\{P\in\mathbb{A}^n:P^\sigma=P,\forall\sigma\in G_{\bar{K}/K}\}.
	\end{equation*}
\end{rem}

Using ideals in $\bar{K}[X]$ leads to the construction of an algebraic set on $\mathbb{A}^n$.
\begin{defn}
	Taking $I\subset\bar{K}[X]$ as an ideal, each of these can be associated with a subset of $\mathbb{A}^n$ such that
	\begin{equation*}
	V_I=\{P\in\mathbb{A}^n:f(P)=0,\forall f\in I\}.
	\end{equation*}
	Any set of this form is an algebraic set.
\end{defn}

On an algebraic set, in turn, the ideal may be defined.
\begin{defn}
	Given an algebraic set V, the ideal of V is
	\begin{equation*}
	I(V)=\{f\in\bar{K}[X]:f(P)=0,\forall P\in V\}.
	\end{equation*}	
\end{defn}
If $I(V)$ can be generated by polynomials in $K[X]$ for an algebraic set $V$, it is defined over $K$ and noted as $V/K$.

Using an algebraic set $V$ and the corresponding ideal $I(V)$ leads to the definition of an affine variety.
\begin{defn}
	$V$ is called an affine variety if $I(V)$ is a prime ideal in $\bar{K}[X]$.
\end{defn}

\subsection{Projective Varieties}
Making an affine space a projective space is done by adding the so called ``points at infinity". This same process can be recreated to define projective varieties.
\begin{defn}
	$\mathbb{P}^n=\mathbb{P}^n(\bar{K})$ denotes the projective $n$-space over $K$ and is constructed as the set of all $(n+1)$ tuples
	\begin{equation*}
	(x_0,\dots,x_n)\in\mathbb{A}^{n+1}.
	\end{equation*}
	
	These tuples must be such that at least one element is nonzero modulo the following equivalence relation
	\begin{equation*}
	(x_0,\dots,x_n)\sim(y_0,\dots,y_n)
	\end{equation*}
	
	if there is a $\lambda\in\bar{K}^*$ such that $x_i=\lambda y_i,\forall i$. The resulting equivalence class
	\begin{equation*}
	\{(\lambda x_0,\dots,\lambda x_n):\lambda\in\bar{K}^*\}
	\end{equation*}
	
	is noted as $[x_0,\dots,x_n]$, with the elements being called homogeneous coordinates for the point $P\in\mathbb{P}^n$ that corresponds to it. This leads to the set of $K$-rational points in $\mathbb{P}^n$
	\begin{equation*}
	\mathbb{P}^n(K)=\{[x_0,\dots,x_n]\in\mathbb{P}^n:x_i\in K\}
	\end{equation*}
\end{defn}
As with affine varieties, the Galois group $G_{\bar{K}/K}$ allows for an alternate definition of $\mathbb{P}^n(K)$.
\begin{rem}
	The Galois group $G_{\bar{K}/K}$ acts on $P\in\mathbb{P}^n$ via
	\begin{equation*}
	[x_0,\dots,x_n]^\sigma=[x_0^\sigma,\dots,x_n^\sigma]
	\end{equation*}
	and as such it leads to
	\begin{equation*}
	\mathbb{P}^n(K)=\{P\in\mathbb{P}^n:P^\sigma=P,\forall\sigma\in G_{\bar{K}/K}\}
	\end{equation*}
\end{rem}

With the existence homogeneous coordinates, homogeneous polynomials and ideals can be defined.
\begin{defn}
	A polynomial $f\in\bar{K}[X]$ is homogeneous of degree $d$ if
	\begin{equation*}
	f(\lambda X_0,\dots,\lambda X_n)=\lambda^df(X_0,\dots,X_n),\forall \lambda\in\bar{K}
	\end{equation*}
	An ideal $I\subset\bar{K}[X]$ is homogeneous if it is generated by homogeneous polynomials.
\end{defn}

With $f$ a homogeneous polynomial, it is interesting to look at points $P\in\mathbb{P}^n$ where $f(P)=0$. Using these points, for each homogeneous ideal $I$ a subset can be defined.
\begin{defn}
	Taking $f$ to be a homogeneous polynomial, any set of the following form for a homogeneous ideal $I$ is a projective algebraic set.
	\begin{equation*}
	V_I=\{P\in\mathbb{P}^n:f(P)=0,\forall f\in I\}
	\end{equation*}
\end{defn}

Such a set has, of itself, a homogeneous ideal.
\begin{defn}
	$I(V)$, the homogeneous ideal of $V$ is the ideal of $\bar{K}[X]$ that is generated with homogeneous $f$ by
	\begin{equation*}
	\{f\in\bar{K}[X]:f(P)=0,\forall P\in V\}
	\end{equation*}
\end{defn}

The homogeneous ideal is used to define a projective variety.
\begin{defn}
	If the homogeneous ideal $I(V)$ of projective algebraic set $V_I$ is a prime ideal in $\bar{K}[X]$, the set $V_I$ is called a projective variety.
\end{defn}
\section{Elliptic Curves}
An elliptic curve is an algebraic curve of genus one with a certain base point. This section will begin with elliptic curves given by Weierstrass equations, explain the group action on elliptic curves, then look at arbitrary elliptic curves and show that all have a Weierstrass equation study the Weil pairing on elliptic curves. The final section will explain elliptic curve cryptography and give some uses.
\subsection{Weierstrass Equations}
The Weierstrass equation for elliptic curves is written as as follows
\begin{defn}
	Given a base point $O$ and $a_1,\dots,a_6\in\bar{K}$ the Weierstrass equation for an elliptic curve is
	\begin{equation*}
	Y^2Z+a_1XYZ+a_3YZ^2=X^3+a_2X^2Z+a_4XZ^2+a_6Z^3.
	\end{equation*}
	This is generally written with non-homogeneous coordinates $x=X/Z$ and $y=Y$
	\begin{equation*}
	E:y^2+a_1xy+a_3y=x^3+a_2x^2+a_4x+a_6.
	\end{equation*}
	If $a_1,\dots,a_6\in K$, $E$ is said to be defined over $K$.
\end{defn}

If $char(\bar{K})\neq 2$, then this equation an be simplified further by substituting
\begin{equation*}
y=\frac{1}{2}(y-a_1x-a_3).
\end{equation*}

This leads to the following equation
\begin{equation*}
E:y^2=4x^3+b_2x^2+2b_4x+b_6
\end{equation*}

where
\begin{equation*}
{b_2=a_1^2+4a_2}\text{,		}{b_4=2a_4+a_1a_3}\text{,	}{b_6=a_3^2+4a_6}.
\end{equation*}

Furthermore define
\begin{equation*}
b_8=a_1^2a_6+4a_2a_6-a_1a_3a_4+a_2a_3^2-a_4^2,
\end{equation*}
\begin{equation*}
c_4=b_2^2-24b_4,
\end{equation*}
\begin{equation*}
c_6=-b_2^3+36b_2b_4-216b_6,
\end{equation*}
\begin{equation*}
\Delta=-b_2^2-8b_4^3-27b_6^2+9b_2b_4b_6,
\end{equation*}
\begin{equation*}
j=c_4^3/\Delta,
\end{equation*}
\begin{equation*}
\omega=\frac{dx}{2y+a_1x+a_3}=\frac{dy}{3x^2+2a_2x+a_4-a_1y}.
\end{equation*}


Using those, it is easy to see that
\begin{equation*}
4b_8=b_2b_6-b_4^2\text{ and }1728\Delta=c_4^3-c_6^2.
\end{equation*}


If $char(\bar{K})\neq 2,3$, the substitution
\begin{equation*}
(x,y)=(\frac{x-3b_2}{36},\frac{y}{108})
\end{equation*}

allows to eliminate $x^2$, leaving the simple equation
\begin{equation*}
E:y^2=x^3-27c_4x-54c_6.
\end{equation*}

Some of the previously defined quantities have specific meanings.
\begin{defn}
	The value $\Delta$ is the discriminant of the Weierstrass equation, $j$ is the $j$-invariant of the elliptic curve and $\omega$ is the invariant differential that is associated with the Weierstrass equation.
\end{defn}

Because $27c_4$ and $54c_6$ are simple values, the Weierstrass equation of an elliptic curve when the characteristic of $K$ is not 2 or 3 is
\begin{equation*}
E:y^2=x^3+Ax+B.
\end{equation*}

In this case it follows that
\begin{equation*}
\Delta=-16(4A^3+27B^2)\text{ and }j=-1728\frac{(4A)^3}{\Delta}.
\end{equation*}

\subsection{Group Action}
In this section the elliptic curve $E$ is given by a Weierstrass equation. As such, $E\subset\mathbb{P}^2$ consists of points $P=(x,y)$ satisfying
\begin{equation*}
f(x,y)=y^2+a_1xy+a_3y-x^3-a_2x^2-a_4x-a_6=0
\end{equation*}

It is easy to see that the equation has degree three, and that, as such, there are three points of interesection for line $L\subset\mathbb{P}^2$. These points $P,Q,R$ need not be distinct, since $L$ may be a tangent. Using this, the composition law $\oplus$ on $E$ is defined as follows.
\begin{defn}
	Let $P,Q\in E$ and let $L$ be the line through $P$ and $Q$ if the points are distinct, or the tangent to $E$ at $P$ if $P=Q$. Let $R$ be the other point of intersection of $L$ with $E$. Denote by $L'$ the line through $R$ and $O$. Now $L'$ intersects $E$ at $R,O$ and a third point denoted by $P\oplus Q$.
\end{defn}
Now the usage of the symbol is justified by showing that it makes $E$ into an abelian group with identity $O$.
\begin{thm}
	The composition law $\oplus$ has the following properties:
	\begin{enumerate}
		\item If line $L$ intersects $E$ at points $P,Q,R$, not necessarily distinct, then
		\begin{equation*}
		(P\oplus Q)\oplus R=O
		\end{equation*}
		\item $P\oplus O=P\text{\space}\forall P\in E$
		\item $P\oplus Q=Q\oplus P\text{\space}\forall P,Q\in E$
		\item Given $P\in E$ there is a point of $E$, denoted $\ominus P$, such that
		\begin{equation*}
		P\oplus(\ominus P)=O
		\end{equation*}
		\item Given $P,Q,R\in E$
		\begin{equation*}
		(P\oplus Q)\oplus R=P\oplus(Q\oplus R)
		\end{equation*}
		\item Suppose that $E$ is defined over $K$, then the following is a subgroup of $E$
		\begin{equation*}
		E(K)=\{(x,y)\in K^2:y^2+a_1xy+a_3x^2+a_4x+a_6\}\cup\{O\}.
		\end{equation*}
	\end{enumerate}
\end{thm}
\begin{prf}
	\begin{enumerate}
		\item From the definition it follows that the line $L'$ used to construct $P\oplus Q$ intersects $E$ at $R,O$ and $P\oplus Q$. Therefore the intersection point is $O$, and the line through $O$ and $O$ ends up in $O$. In other words, the tangent line to $E$ at $O$ intersects $E$ at $O$ with multiplicity 3.
		\item Note that in this case, the lines $L$ and $L'$ are the same, and that as such the intersection of the line through $O$ and $P\oplus O$ intersects $E$ at precisely $P$.
		\item It is easy to see that the construction of $P\oplus Q$ is symmetric in both $P$ and $Q$. The line through two points that remain fixed does not depend on the order in which the points are picked.
		\item Take a line through $P$ and $O$ and call the intersection point $R$. Using $1.$ and $2.$ it is easy to see that $O=(P\oplus O)\oplus R=P\oplus R.$
		\item This proof will be handled later with explicit formulas.
		\item If both $P$ and $Q$ have coordinates in $K$, then the coefficients of the equation of the line $L$ connecting $P$ and $Q$ are in $K$. If, furthermore, $E$ is defined over $K$ then the third point will be a ratinal combination of coefficients of the line and of $E$, and will thus be in $K$.
	\end{enumerate}
\end{prf}
\begin{rem}
	Since it has been proven that $\oplus$ is a group operation, this thesis will from now on use $+$ instead, and $-$ for $\ominus$. Furthermore, define $mP=\overbrace{P+\dots+P}^m$ if $m>0$, $mP=\overbrace{-P-\dots-P}^m$ if $m<0$ and $0P=O$.
\end{rem}

\subsection{Explicit Formulas}
The various group operations can also be expressed in explicit formulas, which will be derived in this section.
\begin{thm}
	Let $E$ be an elliptic curve given by the Weierstrass equation
	\begin{equation*}
	f(x,y)=y^2+a_1xy+a_3y-x^3-a_2x^2-a_4x-a_6=0,
	\end{equation*}
	\begin{enumerate}
		\item Let $P_0=(x_0,y_0)\in E$. Then
		\begin{equation*}
		-P_0=(x_0,-y_0-a_1x_0-a_3).
		\end{equation*}
		Now let $P_1+P_2=P_3$ with $P_i=(x_i,y_i)\in E$.
		\item If $x_1=x_2$ and $y_1+y_2+a_1x_2+a_3=0$ then
		\begin{equation*}
		P_1+P_2=0.
		\end{equation*}
		If this is not the case, define for $x_1\neq x_2$
		\begin{equation*}
		\lambda=\frac{y_2-y_1}{x_2-x_1}\text{ and }\nu=\frac{y_1x_2-y_2x_1}{x_2-x_1}
		\end{equation*}
		and for $x_1=x_2$
		\begin{equation*}
		\lambda=\frac{3x_1^2+2a_2x_1+a_4-a_1y_1}{2y_1+a_1x_1+a_3}\text{ and }\nu=\frac{-x_1^3+a_4x_1+2a_6-a_3y_1}{2y_1+a_1x_1+a_3}
		\end{equation*}
		Then $y=\lambda x+\nu$ is the line through $P_1$ and $P_2$.
		\item Using the same notation as $2.$, the coordinates for $P_3=P_1+P_2$ are
		\begin{equation*}
		(x_3=\lambda^2+a_1\lambda-a_2-x_1-x_2,y_3=-(\lambda+a_1)x_3-\nu-a_3)
		\end{equation*}
	\end{enumerate}
\end{thm}

\begin{prf}
	tba
\end{prf}

\subsection{Elliptic Curves}
This part will focus on linking Weierstrass equations to generic elliptic curves, to show that the results achieved for Weierstrass equations apply generally.
\begin{defn}
	An elliptic curve is a pair $(E,O)$, with $E$ a nonsingular curve of genus one, and $O\in E$. The elliptic curve $E$ is defined over $K$, written as $E/K$, if $E$ is defined over $K$ and $O\in E(K)$.
\end{defn}

To show that elliptic curves and Weierstrass equations are linked the Riemann-Roch theorem is used. See \cite{RiemannRoch} for a proof.
\begin{thm}[Riemann-Roch]
	Let $C$ be a smooth curve and let $K_C$ be a canonical divisor on $C$. There is an integer $g\geq0$, called the genus of $C$, such that for every divisor $D\in Div(C)$,
	\begin{equation*}
	\ell(D)-\ell(K_C-D)=deg(D)-g+1
	\end{equation*}
\end{thm}

\begin{thm}
	Let $E$ be an elliptic curve defined over $K$, then there exist functions $x,y\in K(E)$ such that the map
	\begin{equation*}
		\phi:e\to\mathbb{P}^2\text{ , }\phi=[x,y,1]
	\end{equation*}
	gives an isomorphism of $E/K$ onto a curve given by the Weierstrass equation
	\begin{equation*}
	C:Y^2+a_1XY+a_3Y=X^3+a_2X^2+a_4X+a_6
	\end{equation*}
	satisfying $\phi(O)=[0,1,0]$. The functions $x$ and $y$ are called the Weierstrass coordinates for the elliptic curve $E$
\end{thm}

This proof will show that the image of the map is indeed in $C$ as described by the Weierstrass equation. The rest of the proof may be found in \cite[page 60]{EllipticCurvesBook}
\begin{prf}
	tba
\end{prf}

\subsection{Weil Pairing}
The Weil pairing will be the last of the mathematical background discussed. This pairing uses $E_m$, the group of $m$-torsion points and $\mu_m$, the group of $m$-th roots of unity.
\begin{defn}
	Setting, for $X\in E$ and $g\in\bar{K}(E)$
	\begin{equation*}
	E_m(S,T)=\frac{g(X+S)}{g(X)}
	\end{equation*}
	the Weil pairing is a non-degenerate alternating bilineair form
	\begin{equation*}
	e_m=E_m\times E_m\to\mu_m
	\end{equation*}
\end{defn}
This pairing has the following properties
\begin{thm}
	The Weil $e_m$ pairing has these properties
	\begin{enumerate}
		\item The pairing is bilinear
		\begin{equation*}
		e_m(S_1+S_2,T)=e_m(S_1,T)e_m(S_2,T),
		\end{equation*}
		\begin{equation*}
		e_m(S,T_1+T_2)=e_m(S,T_1)e_m(S,T_2),
		\end{equation*}
		\item The pairing is alternating
		\begin{equation*}
		e_m(T,T)=1
		\end{equation*}
		which means in particular that
		\begin{equation*}
		e_m(S,T)=e_m(T,S)^{-1}
		\end{equation*}
		\item The pairing is nondegenerate
		\begin{equation*}
		\text{If } e_m(S,T)=1\text{ for all } S\in E_m\text{, then } T=O
		\end{equation*}
		\item The pairing is Galois invariant
		\begin{equation*}
		e_m(S,T)^\sigma=e_m(S^\sigma,T^\sigma)\text{ for all }\sigma\in G_{\bar{K}/K}
		\end{equation*}
		\item The pairing is compatible
		\begin{equation*}
		e_{mm'}(S,T)=e_m(m'S,T)\text{ for all }S\in E_{mm'}\text{ and }T\in E_m
		\end{equation*}
	\end{enumerate}
\end{thm}

\begin{prf}
	\begin{enumerate}
		\item tba
		\item tba
		\item tba
	\end{enumerate}
\end{prf}
The resulting proofs may be found in \cite[page 96]{EllipticCurvesBook} but are not of particular interest in this thesis.